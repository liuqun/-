# -*- encoding: utf-8 -*-
from os.path import abspath, dirname, join
from unittest import TestCase
from AppliancePredictor import AppliancePredictor

default_test_data_txt = """1.000000000000000021e-02 -4.000000000000000083e-02 4.000000000000000083e-02 -2.000000000000000042e-02 -4.000000000000000083e-02 -5.000000000000000278e-02 -2.999999999999999889e-02 -2.999999999999999889e-02 -8.000000000000000167e-02 1.000000000000000021e-02 -1.000000000000000021e-02 -2.000000000000000042e-02 -4.000000000000000083e-02 -2.999999999999999889e-02 -7.000000000000000666e-02 5.999999999999999778e-02 2.000000000000000042e-02 -1.000000000000000021e-02 -2.999999999999999889e-02 -7.000000000000000666e-02 -0.000000000000000000e+00 -2.000000000000000042e-02 -2.999999999999999889e-02 -4.000000000000000083e-02 0.000000000000000000e+00 4.000000000000000083e-02 -5.000000000000000278e-02 -1.000000000000000021e-02 0.000000000000000000e+00 4.000000000000000083e-02 4.000000000000000083e-02 -4.000000000000000083e-02 0.000000000000000000e+00 2.999999999999999889e-02 2.000000000000000042e-02 2.000000000000000042e-02 -1.000000000000000021e-02 4.000000000000000083e-02 -0.000000000000000000e+00 0.000000000000000000e+00 -5.000000000000000278e-02 1.000000000000000021e-02 5.000000000000000278e-02 -5.000000000000000278e-02 2.999999999999999889e-02 2.000000000000000042e-02 1.000000000000000021e-02 4.000000000000000083e-02 2.000000000000000042e-02 -5.999999999999999778e-02 4.000000000000000083e-02 0.000000000000000000e+00 -0.000000000000000000e+00 -2.000000000000000042e-02 -0.000000000000000000e+00 -2.000000000000000042e-02 2.000000000000000042e-02 -4.000000000000000083e-02 2.000000000000000042e-02 4.000000000000000083e-02 -0.000000000000000000e+00 5.000000000000000278e-02 4.000000000000000083e-02 1.000000000000000021e-02 1.000000000000000021e-02 -1.000000000000000021e-02 7.000000000000000666e-02 -2.000000000000000042e-02 2.000000000000000042e-02 -2.000000000000000042e-02 -2.999999999999999889e-02 5.000000000000000278e-02 2.000000000000000042e-02 -2.000000000000000042e-02 5.999999999999999778e-02 -5.999999999999999778e-02 -4.000000000000000083e-02 -2.999999999999999889e-02 -7.000000000000000666e-02 -7.000000000000000666e-02
6.540000000000000036e+00 3.271000000000000085e+01 6.540999999999999659e+01 9.893000000000000682e+01 1.275499999999999972e+02 1.618899999999999864e+02 1.815099999999999909e+02 2.003199999999999932e+02 2.207599999999999909e+02 2.379300000000000068e+02 2.681800000000000068e+02 2.820799999999999841e+02 3.008899999999999864e+02 3.139700000000000273e+02 3.049700000000000273e+02 3.033399999999999750e+02 3.025199999999999818e+02 3.041600000000000250e+02 3.025199999999999818e+02 3.016999999999999886e+02 3.041600000000000250e+02 3.016999999999999886e+02 3.008899999999999864e+02 3.000699999999999932e+02 3.000699999999999932e+02 2.984300000000000068e+02 3.008899999999999864e+02 2.910699999999999932e+02 2.714499999999999886e+02 2.485600000000000023e+02 2.158499999999999943e+02 1.888700000000000045e+02 1.610699999999999932e+02 1.250999999999999943e+02 8.993999999999999773e+01 5.560000000000000142e+01 2.698000000000000043e+01 0.000000000000000000e+00 -3.025000000000000000e+01 -5.886999999999999744e+01 -8.829999999999999716e+01 -1.250999999999999943e+02 -1.504399999999999977e+02 -1.766100000000000136e+02 -2.019499999999999886e+02 -2.142199999999999989e+02 -2.330200000000000102e+02 -2.526500000000000057e+02 -2.747200000000000273e+02 -2.918899999999999864e+02 -3.074300000000000068e+02 -3.098799999999999955e+02 -3.098799999999999955e+02 -3.082500000000000000e+02 -3.074300000000000068e+02 -3.090600000000000023e+02 -3.074300000000000068e+02 -3.098799999999999955e+02 -3.049700000000000273e+02 -3.057900000000000205e+02 -3.049700000000000273e+02 -2.886200000000000045e+02 -3.041600000000000250e+02 -3.066100000000000136e+02 -3.008899999999999864e+02 -2.853500000000000227e+02 -2.616399999999999864e+02 -2.420200000000000102e+02 -2.101299999999999955e+02 -1.790600000000000023e+02 -1.479900000000000091e+02 -1.079300000000000068e+02 -7.521999999999999886e+01 -4.906000000000000227e+01 -8.990000000000000213e+00 8.179999999999999716e+00 3.760999999999999943e+01 7.195000000000000284e+01 1.054699999999999989e+02 1.357299999999999898e+02
"""


class DefaultTestCase(TestCase):
    def test_default(self):
        # # 测试数据加载与转换
        # path_for_test_data = '测试样本.txt'
        # import numpy as np
        # test_data = np.loadtxt(path_for_test_data)
        # # 数据维度处理
        # seq_len = 80
        # input_dim = 1
        # rsp_test_data = np.reshape(test_data, (int(len(test_data) / input_dim), input_dim, seq_len))
        rsp_test_data = [
            [[1.0000e-02, -4.0000e-02, 4.0000e-02, -2.0000e-02, -4.0000e-02,
              -5.0000e-02, -3.0000e-02, -3.0000e-02, -8.0000e-02, 1.0000e-02,
              -1.0000e-02, -2.0000e-02, -4.0000e-02, -3.0000e-02, -7.0000e-02,
              6.0000e-02, 2.0000e-02, -1.0000e-02, -3.0000e-02, -7.0000e-02,
              -0.0000e+00, -2.0000e-02, -3.0000e-02, -4.0000e-02, 0.0000e+00,
              4.0000e-02, -5.0000e-02, -1.0000e-02, 0.0000e+00, 4.0000e-02,
              4.0000e-02, -4.0000e-02, 0.0000e+00, 3.0000e-02, 2.0000e-02,
              2.0000e-02, -1.0000e-02, 4.0000e-02, -0.0000e+00, 0.0000e+00,
              -5.0000e-02, 1.0000e-02, 5.0000e-02, -5.0000e-02, 3.0000e-02,
              2.0000e-02, 1.0000e-02, 4.0000e-02, 2.0000e-02, -6.0000e-02,
              4.0000e-02, 0.0000e+00, -0.0000e+00, -2.0000e-02, -0.0000e+00,
              -2.0000e-02, 2.0000e-02, -4.0000e-02, 2.0000e-02, 4.0000e-02,
              -0.0000e+00, 5.0000e-02, 4.0000e-02, 1.0000e-02, 1.0000e-02,
              -1.0000e-02, 7.0000e-02, -2.0000e-02, 2.0000e-02, -2.0000e-02,
              -3.0000e-02, 5.0000e-02, 2.0000e-02, -2.0000e-02, 6.0000e-02,
              -6.0000e-02, -4.0000e-02, -3.0000e-02, -7.0000e-02, -7.0000e-02, ]],
            [[6.5400e+00, 3.2710e+01, 6.5410e+01, 9.8930e+01, 1.2755e+02,
              1.6189e+02, 1.8151e+02, 2.0032e+02, 2.2076e+02, 2.3793e+02,
              2.6818e+02, 2.8208e+02, 3.0089e+02, 3.1397e+02, 3.0497e+02,
              3.0334e+02, 3.0252e+02, 3.0416e+02, 3.0252e+02, 3.0170e+02,
              3.0416e+02, 3.0170e+02, 3.0089e+02, 3.0007e+02, 3.0007e+02,
              2.9843e+02, 3.0089e+02, 2.9107e+02, 2.7145e+02, 2.4856e+02,
              2.1585e+02, 1.8887e+02, 1.6107e+02, 1.2510e+02, 8.9940e+01,
              5.5600e+01, 2.6980e+01, 0.0000e+00, -3.0250e+01, -5.8870e+01,
              -8.8300e+01, -1.2510e+02, -1.5044e+02, -1.7661e+02, -2.0195e+02,
              -2.1422e+02, -2.3302e+02, -2.5265e+02, -2.7472e+02, -2.9189e+02,
              -3.0743e+02, -3.0988e+02, -3.0988e+02, -3.0825e+02, -3.0743e+02,
              -3.0906e+02, -3.0743e+02, -3.0988e+02, -3.0497e+02, -3.0579e+02,
              -3.0497e+02, -2.8862e+02, -3.0416e+02, -3.0661e+02, -3.0089e+02,
              -2.8535e+02, -2.6164e+02, -2.4202e+02, -2.1013e+02, -1.7906e+02,
              -1.4799e+02, -1.0793e+02, -7.5220e+01, -4.9060e+01, -8.9900e+00,
              8.1800e+00, 3.7610e+01, 7.1950e+01, 1.0547e+02, 1.3573e+02, ]]
        ]

        # 模型文件存放路径(目录中应包含checkpoint文件、meta文件、data文件和index文件，目录名称一般不变)
        project_dir = dirname(abspath(__file__))
        path_for_check = join(project_dir, '模型')

        # # 负荷名称(不需修改)
        # appliance = {0: 'aux电饭煲-开始', 1: 'ipad air2-充电', 2: '吹风机-2档热1档风', 3: '戴尔E6440',
        #              4: '挂烫机-1档', 5: '华为P9Plus充电', 6: '九阳电饭煲-蒸煮', 7: '空调-吹风', 8: '空调-制冷',
        #              9: '联想扬天(台式机 显示器)', 10: '水壶', 11: '无电器运行', 12: '吸尘器'}

        # 模型预测
        predictor = AppliancePredictor()
        predictor.load_model(path_for_check)
        output_index = predictor.predict(rsp_test_data)

        self.assertEqual(len(output_index), 2)
        self.assertEqual(11, int(output_index[0]))
        self.assertEqual(0, int(output_index[1]))
